// Test built-in traits: Equal, Order, Numeric, Default

// Test Order constraint with max function
fun max<t: Order>(a: t, b: t) -> t {
    if a > b { a } else { b }
}

print(max(10, 20))      // 20
print(max(3.5, 2.1))    // 3.5
print(max(100n, 50n))   // 100

// Test Numeric constraint with sum function
fun sum<t: Numeric>(a: t, b: t, c: t) -> t {
    a + b + c
}

print(sum(1, 2, 3))        // 6
print(sum(1.0, 2.0, 3.0))  // 6

// Test Equal constraint
fun allEqual<t: Equal>(a: t, b: t, c: t) -> Bool {
    a == b && b == c
}

print(allEqual(5, 5, 5))        // true
print(allEqual(1, 2, 1))        // false
print(allEqual("a", "a", "a"))  // true

// Test default function
print(default(Int))     // 0
print(default(Float))   // 0
print(default(Bool))    // false

// Test modulo
print(17 % 5)   // 2
print(10 % 3)   // 1
print(-7 % 3)   // -1

// Test custom type implementing built-in Default trait
// Records automatically get default from field defaults
type Point = { x: Int, y: Int }
instance Default Point {}
p: Point = default(Point)
print(p.x)  // 0
print(p.y)  // 0

// ADT type with custom getDefault method
type Counter = MkCounter Int

instance Default Counter {
    fun getDefault(dummy: Counter) -> Counter {
        MkCounter(0)
    }
}

fun unwrap(c: Counter) -> Int {
    match c { MkCounter n -> n }
}

c: Counter = default(Counter)
print(unwrap(c))  // 0

// ============================================
// 8. Operators as functions with traits
// ============================================
fun fold(f: (r, t) -> r, init: r, list: List<t>) -> r {
    match list {
        [] -> init
        [head, ...tail] -> fold(f, f(init, head), tail)
    }
}

// Using (+) as function
sumVal = fold((+), 0, [1, 2, 3, 4, 5])
print(sumVal)  // 15

// Using (*) as function
product = fold((*), 1, [1, 2, 3, 4])
print(product)  // 24

// Using (&&) and (||) as functions
allTrue = fold((&&), true, [true, true, true])
print(allTrue)  // true

anyTrue = fold((||), false, [false, true, false])
print(anyTrue)  // true

print("All built-in traits work!")
