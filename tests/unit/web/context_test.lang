import "kit/web"
import "lib/test" (*)

testRun("Web Context - Form Parsing", fun() {
    req = {
        method: "POST",
        path: "/submit",
        query: "",
        headers: [],
        cookies: [],
        body: "name=Alice&age=30"
    }

    ctx = web.context(req)

    match web.formParam("name", ctx) {
        Some(val) -> assertEquals(val, "Alice", "name param correct")
        None -> assertFail(Ok(0), "name param missing")
    }

    match web.formParam("age", ctx) {
        Some(val) -> assertEquals(val, "30", "age param correct")
        None -> assertFail(Ok(0), "age param missing")
    }

    match web.formParam("missing", ctx) {
        Some(_) -> assertFail(Ok(0), "missing param found")
        None -> assert(true, "missing param not found")
    }
})

