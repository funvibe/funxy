package traits_pkg (*)

import "lib/string" (*)

// 1. Basic Trait
trait SimpleTrait<t> {
    fun simpleMethod(val: t) -> String
}

// 2. Trait with Operator
trait OpTrait<t> {
    fun plus(a: t, b: t) -> t
}

// 3. Trait with Default Method
trait DefaultTrait<t> {
    fun required(val: t) -> String
    fun optional(val: t) -> String {
        "default: " ++ required(val)
    }
}

// 4. Inheritance Chain
trait GrandParent<t> {
    fun gpMethod(val: t) -> String { "gp" }
    fun overrideMe(val: t) -> String { "gp_orig" }
}

trait Parent<t>: GrandParent<t> {
    fun pMethod(val: t) -> String { "p" }
    fun overrideMe(val: t) -> String { "p_overridden" }
}

trait Child<t>: Parent<t> {
    fun cMethod(val: t) -> String { "c" }
}

// 5. Box struct (ADT with named fields)
type MyBox = Box { val: String }

// Implementations
instance SimpleTrait MyBox {
    fun simpleMethod(b) {
        match b { Box(r) -> "simple:" ++ r.val }
    }
}

instance DefaultTrait MyBox {
    fun required(b) {
        match b { Box(r) -> r.val }
    }
}

instance OpTrait MyBox {
    fun plus(a, b) {
        match (a, b) {
            (Box(r1), Box(r2)) -> Box({ val: r1.val ++ r2.val })
            _ -> Box({ val: "error" })
        }
    }
}

instance GrandParent MyBox {}
instance Parent MyBox {}
instance Child MyBox {}

// ...
// 6. Deep Inheritance Test Type
type DeepBoxType = DeepBoxVal(String)

instance GrandParent DeepBoxType {
    fun gpMethod(d) { "deep_gp" }
}
instance Parent DeepBoxType {}
instance Child DeepBoxType {
    fun cMethod(d) { "deep_c" }
}
