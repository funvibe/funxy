package core (*)

import "lib/string" (*)

// Base types
type Entity = MkEntity { id: Int, name: String, version: Int }
type Status = Active | Inactive | Pending { reason: String }

// Core trait
trait Validator<t> {
    fun validate(val: t) -> Bool
    fun getMessage(val: t) -> String
    fun getErrors(val: t) -> List<String>
}

// Core trait with default methods
trait Auditable<t> {
    fun audit(val: t) -> String
    fun timestamp(val: t) -> Int { 0 }
}

// Extension method
fun (e: Entity) display() {
    match e {
        MkEntity(r) -> "Entity(id=" ++ show(r.id) ++ ", name=" ++ r.name ++ ", v=" ++ show(r.version) ++ ")"
    }
}

fun (e: Entity) incrementVersion() {
    match e {
        MkEntity(r) -> MkEntity $ { id: r.id, name: r.name, version: r.version + 1 }
    }
}

